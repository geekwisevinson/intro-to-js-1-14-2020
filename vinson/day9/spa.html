<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Spa</title>
</head>
<body>



<script>
    const globalData = {
        images: ['https://image.shutterstock.com/image-illustration/3d-computer-desktop-pc-pc3d-260nw-1190426668.jpg', 'https://www.pcsknox.com/images/easyblog_articles/426/Gnome-computer.png'],
        imageIndex: 0,
        pages: {},
        components: {},
    };
    loadPage('home');
    function getTextFromFile(type, file) {
        return fetch(`./${type}/${file}.html`)
            .then( res => { return res.text() });
    }
    function loadPage(file) {
        return getTextFromFile('pages', file).then( res => {
                updateHtml(document.body, res);
                checkForComponents(document.body);
            });
    }
    function loadComponent(file) {
        return getTextFromFile('components', file);
    }
    function checkForComponents(el) {
        const components = el.querySelectorAll('[data-component]');
        components.forEach( component => {
            console.log(component, 'component');
            const componentName = component.getAttribute('data-component');
            const models = JSON.parse(component.getAttribute('data-models'));
            console.log(componentName, models);
            loadComponent(componentName).then( text => {
                component.innerHTML = text;
                for (let prop in models) {
                    component.innerHTML = replaceText(text, prop, models[prop]);
                }
                changeImage(0);
            });
        })
    }

    function replaceText(string, textToReplace, textWeWant) {
        return string.replace(textToReplace, textWeWant)
    }
    function updateHtml(el, text) {
        el.innerHTML = text;
    }

    function changeImage(value) {
        const img = document.querySelector('img');
        if (img) {
            globalData.imageIndex += value;
            if (globalData.imageIndex < 0) {
                globalData.imageIndex = globalData.images.length - 1;
            }
            if (globalData.imageIndex > globalData.images.length - 1) {
                globalData.imageIndex = 0;
            }
            img.src = globalData.images[globalData.imageIndex];
        }
    }


</script>

</body>
</html>
